# 13장. 스코프

**[목차]**
- 13장. 스코프
  - [13-1. 스코프란](#13-1-스코프란)
  - [13-2. 스코프의 종류](#13-2-스코프의-종류)
    - [13-2-1. 전역과 전역 스코프](#13-2-1-전역과-전역-스코프)
    - [13-2-2. 지역과 지역 스코프](#13-2-2-지역과-지역-스코프)
  - [13-3. 스코프 체인](#13-3-스코프-체인)
    - [13-3-1. 스코프 체인에 의한 변수 검색](#13-3-1-스코프-체인에-의한-변수-검색)
    - [13-3-2. 스코프 체인에 의한 함수 검색](#13-3-2-스코프-체인에-의한-함수-검색)
  - [13-4. 함수 레벨 스코프](#13-4-함수-레벨-스코프)
  - [13-5. 렉시컬 스코프](#13-5-렉시컬-스코프)
  - [요약](#요약)
  - [키워드](#키워드)
  - [Reference](#reference)

<br>

## 13-1. 스코프(Scope)란
- **스코프(scope)는 변수와 함수가 유효한 범위**를 가지는 개념입니다.
- 스코프는 변수와 함수가 어디에서 접근 가능한지를 결정합니다.
- 스코프는 변수의 유효 범위를 제한하여 이름 충돌을 방지하고 변수와 함수를 구분 짓는 역할을 합니다.
- 스코프는 변수가 선언된 위치에 의해 결정됩니다.
- JavaScript에서는 전역 스코프, 함수 스코프, 블록 스코프 등 다양한 유형의 스코프가 있습니다.

```jsx
// 예제 13-1
function add(x, y){
    // 매개 변수는 함수 몸체 내부에서만 참조 할 수 있다.
    // 즉, 매개 변수의 스코프(유효 범위)는 함수 몸체이다.
    console.log(x, y);
}

add(2, 5);

// 매개 변수는 함수 몸체 내부에서만 참조할 수 있다.
console.log(x, y) // ReferenceError
```
> `add` 함수는 매개 변수 `x`와 `y`를 가지고 있습니다. 이 매개 변수들은 함수 몸체 내부에서만 참조할 수 있으며, 함수 몸체 외부에서는 접근할 수 없습니다.
> 따라서 `console.log(x, y)`를 함수 몸체 외부에서 호출하면 `ReferenceError`가 발생합니다.
> 이는 변수 `x`와 `y`의 스코프가 함수 몸체 내부로 제한되기 때문입니다.

- 각 변수는 해당 스코프 내에서만 접근 가능합니다.
- 변수를 해당 스코프 외부에서 접근하려고 시도하면 변수가 정의되지 않았다는 `ReferenceError`가 발생합니다.

```jsx
// 예제 13-2
var var1 = 1; // 코드의 가장 바깥 영역에서 선언한 변수

if(true){
    var var2 = 2; // 코드 블록 내에서 선언한 변수

    if(true){
        var var3 = 3; // 중첩된 코드 블록 내에서 선언한 변수
    }
}

function foo(){
    var var4 = 4; // 함수 내에서 선언한 변수

    function bar(){
        var var5 = 5; // 중첩된 함수 내에서 선언한 변수
    }
}

console.log(var1)
console.log(var2)
console.log(var3)
console.log(var4)
console.log(var5)
```
- `var1`: 전역 스코프에서 선언된 변수이므로 어디서든 접근 가능합니다.
- `var2`: `if 문`의 코드 블록 내에서 선언된 변수이므로 해당 코드 블록 내에서 접근 가능합니다.
- `var3`: 중첩된 `if 문`의 코드 블록 내에서 선언된 변수이므로 해당 코드 블록 내에서 접근 가능합니다.
- `var4`: `foo` 함수 내에서 선언된 변수이므로 해당 함수 내에서 접근 가능합니다.
- `var5`: `bar` 함수 내에서 선언된 변수이므로 해당 함수 내에서 접근 가능합니다. 하지만 `var5`는 `foo` 함수 외부에서는 접근할 수 없으므로 `console.log(var5)`는 `ReferenceError`를 발생시킵니다.

```jsx
// 예제 13-3
var x = 'global';

function foo(){
    var x = 'local';
    console.log(x)
}

foo();

console.log(x);
```
>`foo` 함수를 호출하면 함수 내부의 `console.log(x)`가 실행되고, 함수 스코프 내에서 선언된 변수 `x`의 값인 `'local'`이 출력됩니다.
> 그 후, 전역 스코프에서 `console.log(x)`가 실행되고, 전역 스코프에서 선언된 변수 `x`의 값인 `'global'`이 출력됩니다.

- 동일한 이름의 변수가 다른 스코프에서 선언될 경우, 해당 스코프 내에서 변수의 값이 우선적으로 사용됩니다.

<br>

## 13-2. 스코프의 종류
스코프는 전역 스코프(Global Scope)와 지역 스코프(Local Scope)로 구분할 수 있습니다.

- **전역 스코프**: 전역 스코프는 코드의 가장 바깥 영역으로, 함수나 블록 내부가 아닌 곳에서 선언된 변수들이 속하는 범위입니다. 전역 스코프에 선언된 변수는 어디서든지 접근할 수 있습니다.
- **지역 스코프**: 지역 스코프는 함수나 블록 내부에서 선언된 변수들이 속하는 범위입니다. 지역 스코프에 선언된 변수는 해당 함수나 블록 내에서만 접근할 수 있습니다.

```jsx
// 그림 13-2
// 전역 스코프와 지역 스코프
var x = "global x";
var y = "global y";

function outer(){
    var z = "outer's local z";

    console.log(x);
    console.log(y);
    console.log(z);

    function inner(){
        var x = "inner's local x";

        console.log(x);
        console.log(y);
        console.log(z);
    }
    inner();
}

outer();

console.log(x);
console.log(z);
```
> 전역 스코프에 선언된 `x`와 `y`는 어디서든지 접근 가능합니다. `outer` 함수 내에서 `x`와 `y`를 출력하면 전역 스코프의 `x`와 `y`가 출력됩니다. `outer` 함수 내부에서 선언된 `z`는 `outer` 함수 내부에서만 접근 가능하므로 `inner` 함수 내부에서 `z`를 출력할 수 있습니다. 그러나 `outer` 함수 외부에서 `z`를 출력하면 `ReferenceError`가 발생합니다. 이는 `z`가 지역 스코프인 `outer` 함수 내에서만 유효하기 때문입니다.

<br>

### 13-2-1. 전역과 전역 스코프
- 전역 스코프는 프로그램의 가장 바깥쪽에 있는 스코프를 말합니다.
- 전역 스코프에서 선언된 변수와 함수는 어디에서든지 접근할 수 있습니다.
- 전역 스코프에 선언된 변수와 함수는 프로그램 실행이 끝날 때까지 유지됩니다.

<br>

### 13-2-2. 지역과 지역 스코프
- 지역 스코프는 함수 내부에서 정의된 스코프를 말합니다.
- 지역 스코프에 선언된 변수와 함수는 해당 함수 내부에서만 접근할 수 있습니다.
- 함수가 실행되면 지역 스코프가 생성되고, 함수 실행이 끝나면 해당 스코프는 사라집니다.

<br>

## 13-3. 스코프 체인 (Scope Chain)

- **스코프 체인 (Scope Chain)**:
  - 스코프 체인은 **변수 및 함수의 스코프를 찾기 위해 스코프들이 계층적으로 연결된 구조**입니다.
  - 스코프 체인(scope chain)은 스코프들이 중첩되어 있는 경우 변수를 검색하는 메커니즘입니다.
  - 변수나 함수를 참조할 때, 현재 스코프부터 상위 스코프로 올라가며 변수나 함수를 찾는 과정에서 스코프 체인이 사용됩니다.
  - 스코프 체인을 통해 변수 및 함수가 상위 스코프에서도 접근 가능하게 됩니다.
- **중첩 함수 (Nested Function)**:
  - 중첩 함수는 다른 함수 내부에서 정의된 함수를 의미합니다.
  - 중첩 함수는 자신을 감싸는 외부 함수의 스코프에 접근할 수 있습니다. 이렇게 중첩 함수는 외부 함수의 변수에 접근할 수 있고, 클로저(closure)라고도 불리는 이 특성을 통해 상태를 유지하거나 데이터를 은닉하는 등의 활용이 가능합니다.
- **렉시컬 환경 (Lexical Environment)**:
  - 렉시컬 환경은 변수 식별자와 해당 변수에 바인딩된 값, 그리고 상위 스코프에 대한 참조를 유지하는 내부 데이터 구조입니다.
  - 각각의 스코프는 렉시컬 환경을 가지고 있으며, 스코프 체인은 렉시컬 환경을 통해 구성됩니다.
  - 렉시컬 환경은 변수의 생성, 저장 및 검색을 가능하게 합니다.

<br>

### 13-3-1. 스코프 체인에 의한 변수 검색
- 스코프 체인에 의한 변수 검색은 변수를 찾기 위해 현재 스코프에서 시작하여 상위 스코프로 계속 올라가는 과정을 말합니다. 이 과정은 변수가 현재 스코프에 존재하지 않을 때 수행되며, 상위 스코프에서 변수를 찾을 때까지 계속 진행됩니다.
- 변수를 사용할 때, 해당 변수가 현재 스코프에 존재하는지 먼저 확인합니다. 만약 변수가 현재 스코프에 없다면, 스코프 체인을 따라 상위 스코프로 이동하여 변수를 검색합니다. 이 과정은 필요한 변수를 찾을 때까지 계속 반복됩니다. 만약 변수를 찾지 못하면 에러가 발생합니다.
- 스코프 체인에 의한 변수 검색은 렉시컬 스코프(lexical scope)의 특징 중 하나로, 함수가 정의될 때 함수의 상위 스코프가 결정되기 때문에 변수 검색은 정적으로 이루어집니다. 이는 함수를 어디에서 호출하든지 상위 스코프의 변수를 사용할 수 있다는 것을 의미합니다.

<br>

### 13-3-2. 스코프 체인에 의한 함수 검색
함수도 변수와 마찬가지로 스코프 체인을 따라 검색됩니다. 함수가 호출되면 현재 스코프에서 함수를 찾지 못하면 상위 스코프로 이동하여 함수를 검색합니다. 이렇게 스코프 체인을 따라 올라가면서 함수를 검색하는 것을 스코프 체인에 의한 함수 검색이라고 합니다.

```jsx
// 예제 13-6
function foo(){
    console.log('global function foo')
}

function bar(){
    // 중첩 함수
    function foo(){
        console.log('local function foo')
    }
    foo()
}

bar()
```

<br>

## 13-4. 함수 레벨 스코프(function-level scope)
함수 레벨 스코프(function-level scope)는 변수가 함수 내부에서만 유효한 스코프입니다. 함수 레벨 스코프에서 선언된 변수는 함수 내부에서만 접근할 수 있으며, 함수 외부에서는 해당 변수에 접근할 수 없습니다. 이는 변수가 함수 내에서만 유효하고, 함수 외부에서는 숨겨진(hidden) 상태라는 의미입니다.

```jsx
// 예제 13-7
var x = 1;

if(true){
    // var 키워드로 선언된 변수는 함수의 코드 블록(함수 몸체)만을 지역 스코프로 인정한다.
    // 함수 밖에서 var 키워드로 선언된 변수는 코드 블록 내에서 선언되었다 할지라도 모두 전역이다.
    // 따라서 x는 전역 변수이다. 이미 선언된 전역 변수 x가 있으므로 x 변수는 중복 선언된다.
    // 이는 의도치 않게 변수 값이 변경되는 부작용을 발생 시킨다. 
    var x = 10;
}

console.log(x)
```

```jsx
// 예제 13-8
var i = 10;

// for문에서 선언한 i는 전역 변수이다.
// 이미 선언된 전역 변수 i가 있으므로 중복 선언된다.
for (let i = 0; i < 5; i++) {
    console.log(i)
}

// 의도치 않게 변수의 값이 변경되었다.
console.log(i)
```

## 13-5. 렉시컬 스코프(lexical scope)
렉시컬 스코프(lexical scope)는 변수의 스코프가 코드를 작성하는 시점에 정적으로 결정되는 개념입니다. 즉, 변수가 어디에서 접근 가능한지는 함수를 작성할 때 결정됩니다.
자바스크립트는 대부분의 경우 렉시컬 스코프를 따릅니다. 함수가 정의된 위치에 따라 변수의 스코프가 결정되므로, 함수가 어디에서 호출되는지와는 관계없이 변수의 스코프는 동일합니다.

```jsx
// 예제 13-9
var x = 1;

function foo(){
    var x = 10;
    bar();
}

function bar(){
    console.log(x)
}

foo()
bar()
```


<br>


## 요약

<br>

## 키워드
- 스코프
- 지역 스코프
- 전역 스코프
- 스코프 체인
- 중첩 함수
- 렉시컬 스코프
- 클로저

## Reference

- [Scope](https://developer.mozilla.org/en-US/docs/Glossary/Scope)